## 📊 **核心必实现功能清单**

### **一、单元格样式渲染**

1. **基础样式**

   - ✅ 字体：家族、大小、颜色、粗体、斜体、下划线、删除线
   - ✅ 对齐：水平（左/中/右）、垂直（上/中/下）、文字方向、自动换行、缩进
   - ✅ 数字格式：日期、时间、货币、百分比、科学计数法、自定义格式（如"¥#,##0.00"）
   - ✅ 合并单元格：正确显示和跨单元格内容

2. **边框样式**（必须支持）

   - 边框类型：实线、虚线、点线、双线
   - 边框位置：上、下、左、右、对角线
   - 边框颜色和粗细

3. **填充样式**

   - 纯色背景
   - 渐变填充（线性渐变）
   - 图案填充（网格、斜线等）
   - ✅ **背景颜色是必须实现的**

4. **条件格式**（高级功能）
   - 数据条（data bars）
   - 色阶（color scales）
   - 图标集（icon sets）
   - 基于公式的条件格式

### **二、Sheet 管理功能**

1. **基本切换**

   - 显示所有 sheet 标签页
   - 当前激活 sheet 高亮
   - 支持点击切换

2. **Sheet 操作**（增强体验）

   - 右键菜单：重命名、删除、复制、移动
   - Sheet 颜色标签（tabColor 属性）
   - 显示/隐藏 sheet（支持隐藏 sheet 的切换）
   - 保护状态标识（锁定图标）

3. **多 Sheet 导航**
   - 当 sheet 过多时：横向滚动/下拉选择
   - 固定常用 sheet（pin 功能）
   - 快捷键：Ctrl+PageUp/PageDown 切换

### **三、图形元素处理（按优先级）**

1. **📊 图表 - 建议实现基础预览**

   - 读取图表类型（柱状图、折线图、饼图等）
   - 显示静态图片预览（Excel 存储的图表图片）
   - 显示图表标题和坐标轴信息
   - ❌ **不需要实现交互式图表渲染**（复杂度太高）

2. **🖼️ 图片 - 必须实现**

   - 内嵌图片显示
   - 位置和大小调整
   - 支持常见格式：PNG、JPEG、BMP

3. **🔶 形状 - 选择性实现**

   - 基本形状：矩形、圆形、箭头
   - 文本框（包含格式）
   - 连接线
   - 可以简化为占位框显示

4. **❌ 不需要解析的元素**
   - 控件（按钮、下拉框等）
   - ActiveX 控件
   - OLE 嵌入对象
   - 宏和 VBA 代码

### **四、页面布局和打印设置**

1. **页面设置**

   - 页边距显示
   - 纸张方向和大小
   - 缩放比例

2. **页眉页脚**（重要）

   - 文本内容
   - 页码、总页数、日期等字段
   - ❌ 水印通常在这里，但实现复杂，优先级低

3. **打印区域**
   - 高亮显示打印范围
   - 分页符显示（虚线）

### **五、高级数据功能**

1. **数据验证**（有用）

   - 下拉列表显示
   - 输入限制提示
   - 错误警告样式

2. **超链接**

   - 点击跳转（外部 URL、内部单元格引用）
   - 悬浮显示链接地址

3. **批注/注释**
   - 红色三角标识
   - 鼠标悬停显示内容
   - 作者和时间信息（如有）

### **六、特殊格式处理**

1. **必须实现**

   - 文本旋转（0-180 度）
   - 单元格内换行
   - 富文本（部分单元格支持多种样式）
   - 跨列居中

2. **选择性实现**
   - 单元格样式主题（theme colors）
   - 自动筛选下拉箭头
   - 分级显示（分组行/列）

### **七、水印处理建议**

**❌ 不建议专门解析水印**，因为：

1. Excel 本身没有标准水印功能，通常用以下方式实现：
   - 页眉页脚插入图片
   - 艺术字覆盖
   - 背景图片
2. 解析成本高，收益低
3. 如果确实需要，可以：
   - 检测背景图片作为水印
   - 特殊艺术字样式识别

### **八、性能优化功能**

1. **分块渲染**

   - 只渲染可视区域单元格
   - 虚拟滚动支持

2. **懒加载**

   - 大文件先加载第一个 sheet
   - 其他 sheet 点击时加载

3. **样式缓存**
   - 重复样式复用
   - 减少 DOM 节点

### **九、用户体验功能**

1. **查看模式**

   - 正常视图
   - 页面布局视图（显示页边距）
   - 分页预览（显示分页符）

2. **导航辅助**

   - 冻结窗格（重要！）
   - 行号列标显示
   - 名称框和编辑栏（显示单元格地址和内容）

3. **搜索功能**
   - 当前 sheet 搜索
   - 跨所有 sheet 搜索
   - 支持正则表达式

### **十、导出和兼容性**

1. **导出格式**

   - 保持样式的 HTML 导出
   - CSV 导出（丢失样式）
   - JSON 格式数据

2. **兼容性注意**
   - 新旧 Excel 格式支持（.xls 和.xlsx）
   - 编码问题（中文乱码）
   - 时区处理（日期时间）

## 🎯 **优先级推荐**

### **第一优先级（MVP）**

1. 基础单元格样式（字体、颜色、对齐、背景色）
2. 合并单元格
3. Sheet 切换
4. 图片显示
5. 冻结窗格

### **第二优先级**

1. 边框样式
2. 数字格式
3. 超链接
4. 批注显示
5. 条件格式（简化版）

### **第三优先级**

1. 图表预览（静态图片）
2. 形状基础显示
3. 页眉页脚
4. 数据验证提示

### **可放弃的功能**

1. 交互式图表
2. 水印专门解析
3. 宏和 VBA
4. 动画效果
5. 实时公式计算

一个优秀的 XLSX 预览工具应该**在 85%的场景下还原 Excel 的显示效果**，而不是 100%复制所有功能。专注于用户最常使用的功能，平衡实现成本和用户体验。
